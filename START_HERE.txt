â•”â• â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘  ðŸ”’ Backend Security Integration                            â•‘
â•šâ• â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

âœ… ØªÙ… ØªØ·Ø¨ÙŠÙ‚ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù…Ù‡Ø§Ù… Ø§Ù„Ù€ 5:

1. âœ… Configure Backend as Resource Server
2. âœ… JWT Verification (Signature + Expiration)  
3. âœ… Extract User Roles from Token
4. âœ… Protect APIs with Roles
5. âœ… Test Role-based Access (403 scenarios)

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

ðŸš€ Ø§Ø¨Ø¯Ø£ Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„Ø¢Ù†:

  1. Ø´ØºÙ‘Ù„ Ø§Ù„ØªØ·Ø¨ÙŠÙ‚:
     
     python app.py

  2. Ø§ÙØªØ­ HTML Test Dashboard:
     
     http://127.0.0.1:5000/security-test
     
     Ø«Ù… Ø§Ø¶ØºØ· "Ø§Ø®ØªØ¨Ø§Ø± Ø¬Ù…ÙŠØ¹ Endpoints"

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

ðŸ“‹ Test Endpoints Ø§Ù„Ù…ØªØ§Ø­Ø©:

  ðŸ”“ Public       http://127.0.0.1:5000/api/security/test/public
  ðŸ”’ Auth         http://127.0.0.1:5000/api/security/test/authenticated
  ðŸ‘‘ Admin Only   http://127.0.0.1:5000/api/security/test/admin-only
  ðŸ‘¤ Employee     http://127.0.0.1:5000/api/security/test/employee-only
  ðŸŽ­ Multi-Role   http://127.0.0.1:5000/api/security/test/multi-role
  ðŸ” Token Info   http://127.0.0.1:5000/api/security/test/verify-token
  ðŸ‘‹ Who Am I     http://127.0.0.1:5000/api/security/test/whoami
  ðŸ“‹ All Tests    http://127.0.0.1:5000/api/security/test/all

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

ðŸ§ª Ø§Ø®ØªØ¨Ø§Ø± 403 Scenarios:

  Test 1: Employee â†’ Admin Endpoint
    1. Login as Employee
    2. Go to: /api/security/test/admin-only
    3. Expected: âŒ 403 Forbidden âœ…

  Test 2: Admin â†’ Employee Endpoint  
    1. Login as Admin
    2. Go to: /api/security/test/employee-only
    3. Expected: âŒ 403 Forbidden âœ…

  Test 3: No Auth â†’ Protected Endpoint
    1. Incognito mode
    2. Go to: /api/security/test/authenticated
    3. Expected: âŒ 401 Unauthorized âœ…

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

ðŸ“– Ø§Ù„ÙˆØ«Ø§Ø¦Ù‚:

  ðŸ“˜ Quick Start       â†’ SECURITY_README.md
  ðŸ“— Testing Guide     â†’ SECURITY_TESTING_GUIDE.md
  ðŸ“™ Full Summary      â†’ SECURITY_IMPLEMENTATION_SUMMARY.md

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

ðŸ” Security Logs:

  Ø¹Ø±Ø¶ Ø§Ù„Ù€ logs:
  
  Get-Content logs\app_2025-12-19.log | Select-String "SECURITY"

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

âœ¨ Features Ø§Ù„Ù…Ø¶Ø§ÙØ©:

  âœ… Enhanced JWT verification (signature, expiration, issuer, audience)
  âœ… Role extraction (realm + client roles)
  âœ… @role_required() decorator (single/multiple roles)
  âœ… @roles_required_all() decorator (AND logic)
  âœ… 401 & 403 error handlers
  âœ… Security logging
  âœ… 7 test endpoints
  âœ… HTML test dashboard
  âœ… Python automated tests

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

ðŸŽ¯ Ø§Ù„Ù†ØªÙŠØ¬Ø© Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠØ©:

  âœ… Backend configured as Resource Server
  âœ… JWT tokens fully verified  
  âœ… Roles extracted correctly
  âœ… APIs protected by roles
  âœ… 403 scenarios tested

  ðŸŽ‰ All 5 tasks completed successfully!

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

http://127.0.0.1:5000/api/security/test/public                   âœ… Expected: 200 OK (works without login)


http://127.0.0.1:5000/api/security/test/admin-only               1. Login as Employee
                                                                 2. Open: `http://127.0.0.1:5000/api/security/test/admin-only`
                                                                 3. âœ… Expected: **403 Forbidden**


http://127.0.0.1:5000/api/security/test/employee-only            1. Login as admin
                                                                 2. Open: `http://127.0.0.1:5000/api/security/test/employee-only`
                                                                 3. âœ… Expected: **403 Forbidden**



http://127.0.0.1:5000/api/security/test/verify-token             1. Login (any user)
                                                                 2. Open: `http://127.0.0.1:5000/api/security/test/verify-token`
                                                                 3. âœ… Expected: Token details with verification status


http://127.0.0.1:5000/api/security/test/whoami                  âœ… Expected: Your user info and roles

http://127.0.0.1:5000/api/security/test/multi-role

http://127.0.0.1:5000/api/security/test/authenticated            1. Login (as an Admin or Employee)
                                                                 2. Open : 'http://127.0.0.1:5000/api/security/test/authenticated'
                                                                 3. âœ… Expected: 200 OK response containing the authenticated userâ€™s data.


http://127.0.0.1:5000/security-test
http://127.0.0.1:5000/api/security/test/all





fetch("mysql://127.0.0.1:3306/hr_management") in console
CTRL + U  seacrh: mysql - insert - password - 3306
fetch("/api/employees/1", { method: "DELETE" })    in console
  .then(r => r.status)
  .then(console.log)


  http://127.0.0.1:5000/api/employees in search 

  fetch("/api/employees/1", { method: "DELETE" })
  .then(r => r.status)
  .then(console.log)   when as admin or user 


Test 1: Ù…Ø­Ø§ÙˆÙ„Ø© ÙˆØµÙˆÙ„ ØºÙŠØ± Ù…ØµØ±Ø­:

Ø§ÙØªØ­ Ø§Ù„Ù…ØªØµÙØ­
Ø§Ø°Ù‡Ø¨ Ø¥Ù„Ù‰: http://127.0.0.1:5000/admin/employees
Ø§Ù„Ù†ØªÙŠØ¬Ø© Ø§Ù„Ù…ØªÙˆÙ‚Ø¹Ø©: Redirect to login âœ…

2. Login (Ù…Ø­Ù…ÙŠ Ø¨Ù€ Keycloak)
ÙÙŠ ØµÙØ­Ø© Login:

Email: ' OR '1'='1
Password: anything


Ø³Ø¬Ù„ Ø¯Ø®ÙˆÙ„ ÙƒÙ€ HR_ADMIN

ÙÙŠ Search box Ø£Ø¹Ù„Ù‰ ØµÙØ­Ø© Ø§Ù„Ù€ employees Ø§ÙƒØªØ¨:

Ø£Ùˆ Ø¬Ø±Ø¨:  ' OR 1=1 --                admin' OR '1'='1
Ø§Ù„Ù†ØªÙŠØ¬Ø© Ø§Ù„Ù…ØªÙˆÙ‚Ø¹Ø©:
âœ… Ø§Ù„Ø¨Ø­Ø« ÙŠÙØ´Ù„ Ø£Ùˆ ÙŠØ¹Ø·ÙŠ Ù†ØªØ§Ø¦Ø¬ ÙØ§Ø±ØºØ©
âœ… Ù„Ø§ ÙŠØªÙ… Ø¹Ø±Ø¶ ÙƒÙ„ Ø§Ù„Ù€ employees (Ù„Ùˆ ÙƒØ§Ù† vulnerable ÙƒØ§Ù† Ù‡ÙŠØ¹Ø±Ø¶ ÙƒÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª)

login as admin
fetch('/user/dashboard', {credentials: 'include'})
       .then(r => console.log('Status:', r.status))
   âœ… Expected: Status: 200 (Token valid)      


   Test JWT Verification - Invalid Token
   - Ø§ÙØªØ­ Terminal â†’ PowerShell
   - Command:
     Invoke-WebRequest -Uri "http://127.0.0.1:5000/api/attendance/check-in" -Method POST -UseBasicParsing
   âœ… Expected: 401 Unauthorized + JSON error message

  login as admin
   fetch('/api/get-token', {credentials: 'include'})
       .then(r => r.json())
       .then(d => console.log('Token:', d.access_token.substring(0, 50)))
   âœ… Expected: Token returned successfully


  login as employee
   http://127.0.0.1:5000/admin/employees
   âœ… Expected: 403 Forbidden OR redirect to user dashboard


   Ø§ÙØªØ­ app.py
   - Ø§Ø¨Ø­Ø« Ø¹Ù†:
     @hr_management_required
     @admin_only_required
     @login_required


     Console Command:
     fetch('/api/get-token', {credentials: 'include'})
       .then(r => r.json())
       .then(d => console.log('Access Token:', d.access_token ? 'âœ“ Exists' : 'âœ— Missing'))
   âœ… Expected: Access Token: âœ“ Exists



   Login ÙƒÙ€ HR_ADMIN
   - Ø§ÙØªØ­ Network tab â†’ Clear
   - Ø§Ø°Ù‡Ø¨ Ø¥Ù„Ù‰: Admin â†’ Employees
   - Click "Delete" Ø¹Ù„Ù‰ Ø£ÙŠ employee
   - ÙÙŠ Network tab:
    Filter: /admin/employees/delete
     * Ø§Ø¨Ø­Ø« Ø¹Ù†: Authorization: Bearer eyJ...   in request header
   âœ… Expected: Authorization header present with Bearer token


in terminal
Command:
     Get-ChildItem -Path templates -Filter "*.html" -Recurse | Select-String -Pattern "DB_CONFIG|mysql|DB_HOST"
   âœ… Expected: No results found 


   - Ø§ÙØªØ­: static/js/keycloak_init.js
   - Ø§Ø¨Ø­Ø« Ø¹Ù†: DB_CONFIG, mysql.connector, DB_PASSWORD



   Login ÙƒÙ€ ma@mo.com (EMPLOYEE)
   - Ø§ÙØªØ­ Console
   - Command:
     fetch('http://127.0.0.1:5000/admin/payroll/update-salary', {
  method: 'POST',
  headers: {
    'Content-Type': 'application/x-www-form-urlencoded',
    'Accept': 'application/json'  // â† Ø¯Ù‡ Ø§Ù„Ù…Ù‡Ù…!
  },
  body: 'employee_id=1&basic_salary=5000',
  credentials: 'include'
}).then(r => {
  console.log('Status:', r.status);
  return r.json();
}).then(d => console.log('Response:', d))
   âœ… Expected:
     Status: 403
     Response: {"error":"Forbidden","message":"Access denied..."}