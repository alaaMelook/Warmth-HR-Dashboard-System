{% extends "user/base.html" %}
{% set active = "leaves" %}

{% block content %}
  <!-- Flash Messages (Fixed at top) -->
  {% with messages = get_flashed_messages(with_categories=true) %}
    {% if messages %}
      {% for category, message in messages %}
        {% if category == 'success' %}
          <div class="alert-success" style="position:fixed; top:20px; left:50%; transform:translateX(-50%); z-index:9999; min-width:300px; max-width:500px; text-align:center; box-shadow:0 4px 12px rgba(0,0,0,0.15); animation:slideDown 0.3s ease-out;">
            {{ message }}
          </div>
        {% elif category == 'danger' or category == 'error' %}
          <div class="alert-error" style="position:fixed; top:20px; left:50%; transform:translateX(-50%); z-index:9999; min-width:300px; max-width:500px; text-align:center; box-shadow:0 4px 12px rgba(0,0,0,0.15); animation:slideDown 0.3s ease-out;">
            {{ message }}
          </div>
        {% elif category == 'warning' %}
          <div style="position:fixed; top:20px; left:50%; transform:translateX(-50%); z-index:9999; min-width:300px; max-width:500px; background:#fff6cc; border:1px solid #f2e6a2; color:#9b7e00; padding:12px 24px; border-radius:8px; font-weight:500; box-shadow:0 4px 12px rgba(0,0,0,0.15); animation:slideDown 0.3s ease-out; text-align:center;">
            {{ message }}
          </div>
        {% else %}
          <div style="position:fixed; top:20px; left:50%; transform:translateX(-50%); z-index:9999; min-width:300px; max-width:500px; background:#e8f4ff; border:1px solid #b3d9ff; color:#0056b3; padding:12px 24px; border-radius:8px; font-weight:500; box-shadow:0 4px 12px rgba(0,0,0,0.15); animation:slideDown 0.3s ease-out; text-align:center;">
            {{ message }}
          </div>
        {% endif %}
      {% endfor %}
      <script>
        setTimeout(function() {
          const alerts = document.querySelectorAll('.alert-success, .alert-error, [style*="position:fixed"]');
          alerts.forEach(alert => {
            if (alert && alert.closest('.page-title') === null) {
              alert.style.animation = 'fadeOut 0.5s ease-out forwards';
              setTimeout(() => alert.remove(), 500);
            }
          });
        }, 3000);
      </script>
      <style>
        @keyframes slideDown {
          from { opacity: 0; transform: translateX(-50%) translateY(-20px); }
          to { opacity: 1; transform: translateX(-50%) translateY(0); }
        }
        @keyframes fadeOut {
          from { opacity: 1; transform: translateX(-50%) translateY(0); }
          to { opacity: 0; transform: translateX(-50%) translateY(-10px); }
        }
      </style>
    {% endif %}
  {% endwith %}

  <h1 class="page-title">Leave Management</h1>
  <p class="page-sub">Request time off and view your leave history</p>

  <div class="card leave-request-card" style="padding:24px;">
    <div class="section-header">
      <div class="badge-icon">ğŸ—“ï¸</div>
      <h2 class="section-title">Request Leave</h2>
    </div>

    <form class="form-grid" method="POST" action="{{ url_for('user_leaves') }}" data-requires-auth="true">
      <div class="full-width">
        <label class="form-label">Leave Type <span class="required">*</span></label>
        <select name="leave_type" required>
          <option value="">Select leave type</option>
          <option value="vacation">Vacation Leave</option>
          <option value="sick">Sick Leave</option>
          <option value="personal">Personal Leave</option>
          <option value="unpaid">Unpaid Leave</option>
        </select>
      </div>

      <div>
        <label class="form-label">Start Date <span class="required">*</span></label>
        <input class="input" name="start_date" type="date" required />
      </div>

      <div>
        <label class="form-label">End Date <span class="required">*</span></label>
        <input class="input" name="end_date" type="date" required />
      </div>

      <div class="full-width">
        <label class="form-label">Reason (Optional)</label>
        <textarea name="reason" placeholder="Please provide a reason for your leave request..." style="min-height:80px;"></textarea>
      </div>

      <div class="full-width" style="margin-top:6px;">
        <button class="btn" type="submit">âœˆï¸ Submit Leave Request</button>
      </div>
    </form>
  </div>

  <div class="card leave-history-card" style="padding:24px;margin-top:20px;">
    <h2 class="leave-history-header">Leave History</h2>

    {% if d.leave_history and d.leave_history|length > 0 %}
      <div class="list">
        {% for h in d.leave_history %}
          <div class="list-item">
            <div class="leave-info">
              <div class="badge-icon">
                {% if h.status|lower == 'approved' %}âœ…
                {% elif h.status|lower == 'rejected' %}âŒ
                {% else %}â³
                {% endif %}
              </div>
              <div class="leave-details">
                <div class="title">{{ h.type }}</div>
                <div class="time">{{ h.date }}</div>
              </div>
            </div>

            <div class="leave-status-section">
              <div class="pill days">{{ h.days }} days</div>

              {% set st = h.status|lower %}
              {% if st == 'approved' %}
                <div class="pill status-approved">{{ h.status }}</div>
              {% elif st == 'rejected' %}
                <div class="pill status-rejected">{{ h.status }}</div>
              {% else %}
                <div class="pill status-pending">{{ h.status }}</div>
              {% endif %}
            </div>
          </div>
        {% endfor %}
      </div>
    {% else %}
      <div class="leave-empty-state">
        <div class="leave-empty-icon">ğŸ“</div>
        <div class="leave-empty-text">No leave requests yet.</div>
      </div>
    {% endif %}
  </div>
{% endblock %}
