{% extends "user/base.html" %}
{% set active = "leaves" %}

{% block content %}
  <h1 class="page-title">Leave Management</h1>
  <p class="page-sub">Request time off and view your leave history</p>

  <div class="split">
    <div class="card pad">
      <div style="display:flex;align-items:center;gap:10px;margin-bottom:14px;">
        <div class="badge-icon">üóìÔ∏è</div>
        <div style="font-weight:800;color:#8e6e5e;font-size:16px;">Request Leave</div>
      </div>

      <form class="form-grid">
        <div style="grid-column:1/-1;">
          <label style="font-size:12px;color:#8a7f76;font-weight:600;display:block;margin-bottom:6px;">Leave Type</label>
          <select>
            <option value="">Select leave type</option>
            <option value="vacation">Vacation Leave</option>
            <option value="sick">Sick Leave</option>
            <option value="personal">Personal Leave</option>
            <option value="unpaid">Unpaid Leave</option>
          </select>
        </div>

        <div>
          <label style="font-size:12px;color:#8a7f76;font-weight:600;display:block;margin-bottom:6px;">Start Date</label>
          <input class="input" type="date" placeholder="mm/dd/yyyy" />
        </div>

        <div>
          <label style="font-size:12px;color:#8a7f76;font-weight:600;display:block;margin-bottom:6px;">End Date</label>
          <input class="input" type="date" placeholder="mm/dd/yyyy" />
        </div>

        <div style="grid-column:1/-1;">
          <label style="font-size:12px;color:#8a7f76;font-weight:600;display:block;margin-bottom:6px;">Reason</label>
          <textarea placeholder="Please provide a reason for your leave request..."></textarea>
        </div>

        <div style="grid-column:1/-1;margin-top:6px;">
          <button class="btn" type="button">‚úàÔ∏è Submit Leave Request</button>
        </div>
      </form>
    </div>

    <div class="card pad">
      <div style="font-weight:800;color:#8e6e5e;margin-bottom:14px;font-size:16px;">Leave Balance</div>

      {% if d.leave_balance and d.leave_balance|length > 0 %}
        <div class="list" style="gap:14px;">
          {% for b in d.leave_balance %}
            {% set used = b.used|int %}
            {% set total = b.total|int %}
            {% set pct = (used * 100 / total) if total > 0 else 0 %}

            <div>
              <div style="display:flex;justify-content:space-between;font-size:13px;color:#6f4e3f;font-weight:700;margin-bottom:8px;">
                <span>{{ b.name }}</span>
                <span>{{ used }}/{{ total }} days</span>
              </div>

              <div class="progress {{ 'green' if b.accent=='green' else '' }}">
                <span style="width: {{ (pct|round(0)) ~ '%' }};"></span>
              </div>
            </div>
          {% endfor %}
        </div>
      {% else %}
        <div style="text-align:center;padding:20px;color:#8a7f76;">
          <div style="font-size:35px;margin-bottom:8px;">‚òÇÔ∏è</div>
          <div>No leave balance data.</div>
        </div>
      {% endif %}
    </div>
  </div>

  <div class="card pad" style="margin-top:16px;">
    <div style="font-weight:900;color:#8e6e5e;margin-bottom:14px;font-size:16px;">Leave History</div>

    {% if d.leave_history and d.leave_history|length > 0 %}
      <div class="list">
        {% for h in d.leave_history %}
          <div class="list-item">
            <div style="display:flex;gap:12px;align-items:center;">
              <div class="badge-icon">
                {% if h.status|lower == 'approved' %}‚úÖ
                {% elif h.status|lower == 'rejected' %}‚ùå
                {% else %}‚è≥
                {% endif %}
              </div>
              <div>
                <div class="title">{{ h.type }}</div>
                <div class="time">{{ h.date }}</div>
              </div>
            </div>

            <div style="text-align:right;">
              <div class="pill">{{ h.days }} days</div>

              {% set st = h.status|lower %}
              {% if st == 'approved' %}
                {% set pill_style = "background:#e9f8ef;border-color:#bfe8cf;color:#2f8c52;" %}
              {% elif st == 'rejected' %}
                {% set pill_style = "background:#fff0f0;border-color:#f2bcbc;color:#c54949;" %}
              {% else %}
                {% set pill_style = "background:#fff8e6;border-color:#f2e6a2;color:#b8860b;" %}
              {% endif %}

              <div class="pill" style="{{ 'margin-top:8px;font-weight:600;' ~ pill_style }}">
                {{ h.status }}
              </div>
            </div>
          </div>
        {% endfor %}
      </div>
    {% else %}
      <div style="text-align:center;padding:30px;color:#8a7f76;">
        <div style="font-size:40px;margin-bottom:10px;">üìù</div>
        <div>No leave requests yet.</div>
      </div>
    {% endif %}
  </div>
{% endblock %}